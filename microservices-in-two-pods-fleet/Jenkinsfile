pipeline {
  options {
    buildDiscarder(logRotator(daysToKeepStr: '1', numToKeepStr: '3'))
    disableConcurrentBuilds()
    timestamps()
    timeout(time: 10, unit: 'MINUTES')
  }
  agent { label 'ec2-fleet' }
 stages {
    stage('Push') {
      steps {
          withCredentials([usernamePassword(credentialsId: 'aws_hub_ecr_repo', passwordVariable: 'pass', usernameVariable: 'user')]) {
              sh """
                 export AWS_ACCESS_KEY_ID=AKIAQI7GRHZBX72Y72ME
                 export AWS_SECRET_ACCESS_KEY=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
                 export AWS_DEFAULT_REGION=us-west-1

                 docker ps -a
                 docker login --username $user --password $pass 019273956931.dkr.ecr.eu-west-1.amazonaws.com
                 docker pull 019273956931.dkr.ecr.eu-west-1.amazonaws.com/bibi-ecr-repo:ubuntu_1.0.26
              """
          }
      }//steps
    }//stage
  }//stages
}